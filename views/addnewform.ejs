<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>STUDOCS</title>
  <link href="assets/img/logo.png" rel="icon">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css'>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="/css/addnewform.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.0/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/latest/html2pdf.bundle.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script src="/js/addnewform.js"></script>
</head>
<body>

  <nav class="navbar navbar-expand-sm navbar-dark">
		<a class="navbar-brand logo" href="#">
		  <img src="/assets/img/logo.png" alt="Studocs">
		  STUDOCS
		</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent">
		  <span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse justify-content-end" id="navbarSupportedContent">
		  <ul class="navbar-nav">
			<li class="nav-item">
			  <a class="nav-link active" href="/college/<%=id%>">Home</a>
			</li>
      <li class="nav-item">
			  <a class="nav-link active" href="/addtemplate?id=<%= id%>">Forms</a>
			</li>
      <li class="nav-item">
			  <a class="nav-link active btn2" href="#" data-target="#pub" data-toggle="modal">Publish</a>
			</li>
			<li class="nav-item">
        <a class="nav-link active btn" onclick="generatePDF()">Download <i class="fa fa-download"></i></a>
			  <!-- <a class="nav-link active btn" onclick="generatePDF()">Download <i class="fa fa-download"></i></a> -->
			</li>
		  </ul>
		</div>
  </nav>
  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-6 side1">
        <div class="col-lg-10 panel2">
            <p class="p1">From
              <span class="box1 f1" onclick="showtextarea(1)" id="popup"><i class="fa fa-plus fa-big"></i></span>
              
               <textarea cols="50" rows="3" name="text" id="text1" class="form-control" style="resize:vertical;display:none" placeholder='[name]&#10;[sem&class]&#10;[phone number]' oninput="displayText()"></textarea> 
            
            </p>
            <hr>
            <p class="p1">Date
              <span class="box1 f2" onclick="showtextarea(1)"><i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="3" name="tex2" id="text2" class="form-control" style="resize:vertical;display:none" oninput="displayText()">#date</textarea>
            </p>
            <hr>
            <p class="p1">To
              <span class="box1 f3" onclick="showtextarea(3)"> <i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="3" name="text" id="text3" class="form-control" style="resize:vertical;display:none" placeholder='[designation]&#10;[college]' oninput="displayText()"></textarea>
              
            </p>
            </p>
            <hr>
            <p class="p1">Subject
              <span class="box1 f4" onclick="showtextarea(4)"> <i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="1" name="text" id="text4" class="form-control" style="resize:vertical;display:none" placeholder='Subject' oninput="displayText()"></textarea>
            </p>
            <hr>
            <p class="p1">Paragraph 1
              <span class="box1" onclick="showtextarea(6)"><i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="5" name="text" id="text6" class="form-control" style="resize:vertical;display:none" placeholder='starting paragraph' oninput="displayText()"></textarea>
            </p>
            <hr>
            <p class="p1">Paragraph 2
              <span class="box1" onclick="showtextarea(7)"><i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="5" name="text" id="text7" class="form-control" style="resize:vertical;display:none" placeholder='2nd paragraph' oninput="displayText()"></textarea>
            </p>
            <hr>
            <p class="p1">Ending
              <span class="box1" onclick="showtextarea(8)"><i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="3" name="text" id="text8" class="form-control" style="resize:vertical;display:none" placeholder='[Yours sincerely,]&#10;[Name]' oninput="displayText()"></textarea>
            </p>
            <hr>
            <hr>
            <p class="p1">Attachment Required
              <span class="box1" onclick="showtextarea(9)"><i class="fa fa-plus fa-big"></i></span>
              <textarea cols="50" rows="3" name="text" id="text9" class="form-control" style="resize:vertical;display:none" placeholder='enter name of attachments needed' oninput="displayText()" required></textarea>
            </p>
            <hr>
					
          <br>
          <br>

          </div>
        </div>
      
      <div class="col-sm-6 side2">
        <div id="letter-preview" class="col-sm-6 panel">
           <%- templateContent %>
        </div>
        <span class="dropdown show" >
          <select id="selectOption" class="btn btn-secondary scc">
            <option value="Forward To">Forward To</option>
            <option value="tutor">Staff-Adviser</option>
            <option value="hod">HOD</option>
            <option value="principal">Principal</option>
            <option value="office">Office</option>
          </select>
        </span>
      </div>
    </div>
  </div>

  </div>
  
  <div class="modal fade" id="pub" style="margin-top: 250px;">
		<div class="modal-dialog">
			<div class="modal-content">
				<!-- Modal Header -->
				<div class="modal-header">
					<h4 class="modal-title">Publish</h4>
					<button type="button" class="close" data-dismiss="modal" onclick="window.location.href='#'">&times;</button>
				</div>
				<!-- Modal body -->
				<div class="modal-body">
					Would you like to publish the form and make it available to users?
				</div>
				<!-- Modal footer -->
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
					<button type="button" class="btn btn-danger btn2" data-dismiss="modal" onclick=sendDivContent() >Publish</button>
				</div>
			</div>
		</div>
	</div>
<script>
  $(".f2").click(function(){
  $("#text2").toggle();
  })
  window.addEventListener("load", loadValuesFromPreview);
</script>
<script>


function sendDivContent() {
  function getURLParameters() {
    const queryString = window.location.search.slice(1);
    const params = {};

    if (queryString) {
      const paramPairs = queryString.split('&');
      paramPairs.forEach(pair => {
        const [key, value] = pair.split('=');
        params[key] = decodeURIComponent(value);
        console.log(params);
      });
    }

    return params;
  }

  const parameters = getURLParameters();
  const name = parameters.name;
  const selectedOption = document.getElementById("selectOption").value;
  const attachment = document.getElementById('text9').value;

  if (selectedOption === "Forward To" || selectedOption === "") {
    alert("Please select a valid option");
    return;
  }

  var divContent = document.getElementById("letter-preview").innerHTML;

  // Create an AJAX request
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "/save-template?name=" + encodeURIComponent(name) + '&id=<%=id%>', true);
  xhr.setRequestHeader("Content-Type", "application/json");

  // Send the data to the server
  xhr.send(JSON.stringify({ content: divContent, selectedOption: selectedOption,attachment:attachment }));

  // Handle the response from the server
  xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
      var response = JSON.parse(xhr.responseText);
      console.log(response.message);
    }
  };
}

  
</script>
<script>
function loadValuesFromPreview() {
  var from = document.querySelector('.from');
  var date = document.querySelector('.date');
  var to = document.querySelector('.to');
  var subject = document.querySelector('.subject');
  var para1 = document.querySelector('.para1');
  var para2 = document.querySelector('.para2');
  var ending = document.querySelector('.end');

  document.getElementById('text1').value = from ? from.innerText.trim().replace(/<br>/g, '\n') : '';
  document.getElementById('text2').value = date ? date.innerText.trim().replace(/<br>/g, '\n') : '';
  document.getElementById('text3').value = to ? to.innerText.trim().replace(/<br>/g, '\n') : '';
  document.getElementById('text4').value = subject ? subject.innerText.trim().replace(/<br>/g, '\n') : '';
  document.getElementById('text6').value = para1 ? para1.innerText.trim().replace(/<br>/g, '\n') : '';
  document.getElementById('text7').value = para2 ? para2.innerText.trim().replace(/<br>/g, '\n') : '';
  document.getElementById('text8').value = ending ? ending.innerText.trim().replace(/<br>/g, '\n') : '';
}

window.onload = function() {
  loadValuesFromPreview();
};


</script>
</body>
</html>
